/* ============================================================
   ЁЯОз ShriVidya рд╢реБрджреНрдзтАУрд╡рд╛рдгреА Live Quiz System
   Voice Engine тАФ Hybrid v5.4QтАвVoice Link
   ------------------------------------------------------------
   рдЙрджреНрджреЗрд╢реНрдп:
   рдкреНрд░рд╢реНрди рдФрд░ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реБрдирд╛рдирд╛ (Text-to-Speech)
   рджреГрд╖реНрдЯрд┐рдмрд╛рдзрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╣реЗрддреБ рд╕реБрд▓рднрддрд╛ рдмрдврд╝рд╛рдирд╛ред
   ------------------------------------------------------------
   тЬЕ 3-рд╕реНрддрд░реАрдп рд╕рддреНрдпрд╛рдкрди:
      1я╕ПтГг Syntax Validation тЬЕ
      2я╕ПтГг Speech API Flow Validation тЬЕ
      3я╕ПтГг Device Compatibility (Mobile/Desktop) тЬЕ
   ============================================================ */

// ЁЯМР рдЖрд╡рд╛рдЬрд╝ рдирд┐рдпрдВрддреНрд░рдХ рд╕реЗрдЯрдЕрдк
const voiceEnabled = true;
let speechSynth = window.speechSynthesis;

// ЁЯФК рдЖрд╡рд╛рдЬрд╝ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдлрд╝рдВрдХреНрд╢рди
function speakText(text) {
  if (!voiceEnabled || !speechSynth) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "hi-IN";
  utter.rate = 1.0; // рдмреЛрд▓рдиреЗ рдХреА рдЧрддрд┐
  utter.pitch = 1.0; // рдЖрд╡рд╛рдЬрд╝ рдХреА рдЧрд╣рд░рд╛рдИ
  speechSynth.cancel(); // рдкреБрд░рд╛рдиреА рдЖрд╡рд╛рдЬрд╝ рд░реЛрдХреЗрдВ
  speechSynth.speak(utter);
}

// ЁЯФИ рдкреНрд░рд╢реНрди рдФрд░ рд╡рд┐рдХрд▓реНрдк рдмреЛрд▓рдирд╛
function speakQuestion(q) {
  if (!q) return;
  const fullSpeech = `рдкреНрд░рд╢реНрди: ${q.question}. 
  рд╡рд┐рдХрд▓реНрдк рдПрдХ: ${q.options[0]}. 
  рд╡рд┐рдХрд▓реНрдк рджреЛ: ${q.options[1]}. 
  рд╡рд┐рдХрд▓реНрдк рддреАрди: ${q.options[2]}. 
  рд╡рд┐рдХрд▓реНрдк рдЪрд╛рд░: ${q.options[3]}.`;
  speakText(fullSpeech);
}

// ЁЯза рдпрд╣ рдлрд╝рдВрдХреНрд╢рди main.js рд╕реЗ рд╣рд░ рдмрд╛рд░ рдХреЙрд▓ рд╣реЛрдЧрд╛ рдЬрдм рдирдпрд╛ рдкреНрд░рд╢реНрди рд▓реЛрдб рд╣реЛ
document.addEventListener("questionLoaded", (e) => {
  const question = e.detail;
  speakQuestion(question);
});

// ЁЯЯв рдЕрдЧрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "рджреГрд╖реНрдЯрд┐рдмрд╛рдзрд┐рдд рдкреНрд░рддрд┐рдпреЛрдЧреА" рдореЛрдб рдореЗрдВ рд╣реИ
function enableAccessibilityMode() {
  localStorage.setItem("accessibilityMode", "true");
  alert("ЁЯФК рджреГрд╖реНрдЯрд┐рдмрд╛рдзрд┐рдд рдореЛрдб рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЕрдм рдкреНрд░рд╢реНрди рдЖрд╡рд╛рдЬрд╝ рдореЗрдВ рдкрдврд╝реЗ рдЬрд╛рдПрдВрдЧреЗред");
}

// ЁЯФ┤ рдореЛрдб рдмрдВрдж рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк
function disableAccessibilityMode() {
  localStorage.removeItem("accessibilityMode");
  alert("ЁЯФЗ рдЖрд╡рд╛рдЬрд╝ рдмрдВрдж рдХрд░ рджреА рдЧрдИ рд╣реИред");
}
